const axios = require("axios");

module.exports = {
  config: {
    name: "",
    version: "1.0",
    author: "SK-SIDDIK-KHAN", 
    countDown: 5,
    role: 0,
    category: "no prefix"
  },

  onStart: ({}) => {},

  onReply: async function ({ api, event }) {
    if (event.type == "message_reply") {
      const reply = event.body.toLowerCase();
      if (isNaN(reply)) {
        try {
          const response = await axios.get(
            `http://5.78.114.238:5069/sim?type=ask&ask=${encodeURIComponent(reply)}`
          );
          const rs = response.data.data.msg;
          await api.sendMessage(
            rs,
            event.threadID,
            (error, info) => {
              if (error) return console.error(`Failed to send message: ${error.message}`);
              global.GoatBot.onReply.set(info.messageID, {
                commandName: this.config.name,
                type: "reply",
                messageID: info.messageID,
                author: event.senderID,
              });
            },
            event.messageID
          );
        } catch (error) {
          console.error(`Failed to get an answer: ${error.message}`);
          api.sendMessage(
            "",
            event.threadID,
            event.messageID
          );
        }
      }
    }
  },

  onChat: async function ({ api, event }) {
    try {
      const input = event.body.toLowerCase().trim();

      if (input === "bot" || input === "Bot") {
        const messages = [
          "-   -","            - -","           -","   -","     -","  '    -","        -","     -","               ","          -","  -","           -","      -","          -         -","-              -   :- https://www.facebook.com/rxsiddik1","        -","  -","--- --     -","oii--   -","-           -","-   --       -","- -     -","---      -","- --   -","    -","      -","-    -","       -","   -","-         -","-      --    -","-      --       -","-       -","  --  --           -","   -       -","-   -     -","  -     -    -","    -    '-","-       -","    -","-  --    --     --    -","-   --","-     --   -","-- ----- --   -","-  ----  --  -- -","-   --    -","-           --    --     --        -","-    --        -","-  --          -","'     -","-    --       -","-  --    --  - ","-       -!-      -!"," Bot Bot  leave   " , "          " , "      ,ok" , "   ,     " , "Bolo Babu,    ?  " , "      ", " ,  ?" , "  ?  ? ","        ??. " ,  " Bolo   , ? " , "Bot   ," , "Hop bedi,Boss  boss" , "  ,      " , "Bot  ,     " , "  Disturb  ,        " , "      " , "  ,     " , "    mood  " , "  ,      " , " ,    ,  bot bot   " , "       ,    ? " , "  ,  " , "  ,   " , "  ,    ?" , "     " , " ,   " , "    , " , "    Ummmmha  " , "     " , "      " , "Bot  , " , "  " , "            " , "      ..!!  .!! -       --","-     '..!","-' -     -","- - ..!","-   -  ..!","~  ..! ~       ..!","---   - -    - -    ..!","~   ...! ~   ...! ~   ...!","-   ' -  -      -","-        -  -         ..!","-    .! -        .!","-     - -       ..!","-        ...!","-      -  -    ..!","-   -  -     - -     -  -   ..!","-   - -     - -      ..!","-       - -       -","-  - -     -","-- -    - - - -  -","-    prem ..     -","-      .!-       .!"
        ];
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        const sender = await api.getUserInfo(event.senderID);
        const username = sender[event.senderID].name || 'User';
        await api.sendMessage({
          body: ` ${username} \n\n ${randomMessage}`,
          mentions: [{ tag: username, id: event.senderID }],
        }, event.threadID, event.messageID);
        return;
      }

      if (input.startsWith("bot ") || input.startsWith("Bot ")) {
        const query = input.replace(/^(suna|sona)\s+/, "");

        const apiData = await axios.get('https://raw.githubusercontent.com/MOHAMMAD-NAYAN/Nayan/main/api.json');
      const apiUrl = apiData.data.sim;
const response = await axios.get(
          `${apiUrl}/sim?type=ask&ask=${encodeURIComponent(query)}`
        );

        const mg = response.data.data.msg;

        await api.sendMessage(
          mg,
          event.threadID,
          (error, info) => {
            if (error) {
              console.error(`Failed to send message: ${error.message}`);
              return;
            }
            global.GoatBot.onReply.set(info.messageID, {
              commandName: this.config.name,
              type: "reply",
              messageID: info.messageID,
              author: event.senderID,
            });
          },
          event.messageID
        );
        return;
      }

    } catch (error) {
      console.error(`Failed to get an answer: ${error.message}`);
      await api.sendMessage(
        "",
        event.threadID,
        event.messageID
      );
    }
  }
};